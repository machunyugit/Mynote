## 积硅步, 致千里

### 创建索引

| Parameter  | Type     | Description                                                  |
| ---------- | -------- | ------------------------------------------------------------ |
| background | Boolean  | 建索引过程会阻塞其它数据库操作，background可指定以后台方式创建索引，即增加 "background" 可选参数。 "background" 默认值为**false**。 |
| unique     | Boolean  | 建立的索引是否唯一。指定为true创建唯一索引。默认值为**false**. |
| name       | string   | 索引的名称。如果未指定，MongoDB的通过连接索引的字段名和排序顺序生成一个索引名称。 |
| dropDups   | Boolean  | 在建立唯一索引时是否删除重复记录,指定 true 创建唯一索引。默认值为 **false**. |
| sparse     | Boolean  | 对文档中不存在的字段数据不启用索引；这个参数需要特别注意，如果设置为true的话，在索引字段中不会查询出不包含对应字段的文档.。默认值为 **false**. |
| weights    | document | 索引权重值，数值在 1 到 99,999 之间，表示该索引相对于其他索引字段的得分权重 |



### 单个字段上的索引

```javascript
{
  "_id": ObjectId("570c04a4ad233577f97dc459"),
  "score": 1034,
  "location": { state: "NY", city: "New York" }
}
```

1. 在单个字段上创建升序索引 

   * 创建索引

     ```javascript
     //创建正序的索引
     db.records.createIndex({score:1},{name:"scoreAscIndex"})
     //创建倒序的索引
     db.records.createIndex({score:-1},{name:"scoreDescIndex"})
     ```

   * 下面的查询可以用到这个索引

     ```javascript
     db.records.find( { score: 2 } )
     db.records.find( { score: { $gt: 10 } } )
     ```

   * 查询计划

     ```html
     > db.records.find( { score: { $gt: 10 } } ).explain();
     {
             "queryPlanner" : {
                     "plannerVersion" : 1,
                     "namespace" : "user.records",
                     "indexFilterSet" : false,
                     "parsedQuery" : {
                             "score" : {
                                     "$gt" : 10
                             }
                     },
                     "winningPlan" : {
                             "stage" : "FETCH",
                             "inputStage" : {
                                     "stage" : "IXSCAN",
                                     "keyPattern" : {
                                             "score" : 1
                                     },
                                     "indexName" : "scoreAscIndex",
                                     "isMultiKey" : false,
                                     "isUnique" : false,
                                     "isSparse" : false,
                                     "isPartial" : false,
                                     "indexVersion" : 2,
                                     "direction" : "forward",
                                     "indexBounds" : {
                                             "score" : [
                                                     "(10.0, inf.0]"
                                             ]
                                     }
                             }
                     },
                     "rejectedPlans" : [ ]
             },
             "serverInfo" : {
                     "host" : "PC-20170330JXUR",
                     "port" : 27017,
                     "version" : "3.6.5",
                     "gitVersion" : "a20ecd3e3a174162052ff99913bc2ca9a839d618"
             },
             "ok" : 1
     }
     ```

2. 在嵌入的文档中建立索引

   * 创建索引

     ```javascript
     //通过 . 的这种操作对嵌入的文档建立索引
     db.records.createIndex( { "location.state": 1 },{name:"stateIndex"} )
     ```

   * 下面的查询可以用到这个索引

     ```javascript
     db.records.find( { "location.state": "CA" } )
     db.records.find( { "location.city": "Albany", "location.state": "NY" } )
     ```

   * 查询计划

     ```html
     > db.records.find( { "location.city": "Albany", "location.state": "NY" } ).explain();
     {
             "queryPlanner" : {
                     "plannerVersion" : 1,
                     "namespace" : "user.records",
                     "indexFilterSet" : false,
                     "parsedQuery" : {
                             "$and" : [
                                     {
                                             "location.city" : {
                                                     "$eq" : "Albany"
                                             }
                                     },
                                     {
                                             "location.state" : {
                                                     "$eq" : "NY"
                                             }
                                     }
                             ]
                     },
                     "winningPlan" : {
                             "stage" : "FETCH",
                             "filter" : {
                                     "location.city" : {
                                             "$eq" : "Albany"
                                     }
                             },
                             "inputStage" : {
                                     "stage" : "IXSCAN",
                                     "keyPattern" : {
                                             "location.state" : 1
                                     },
                                     "indexName" : "stateIndex",
                                     "isMultiKey" : false,
                                     "isUnique" : false,
                                     "isSparse" : false,
                                     "isPartial" : false,
                                     "indexVersion" : 2,
                                     "direction" : "forward",
                                     "indexBounds" : {
                                             "location.state" : [
                                                     "[\"NY\", \"NY\"]"
                                             ]
                                     }
                             }
                     },
                     "rejectedPlans" : [ ]
             },
             "serverInfo" : {
                     "host" : "PC-20170330JXUR",
                     "port" : 27017,
                     "version" : "3.6.5",
                     "gitVersion" : "a20ecd3e3a174162052ff99913bc2ca9a839d618"
             },
             "ok" : 1
     }
     ```

### 复合索引

1. 语法

   ```html
   db.collection.createIndex( { <field1>: <type>, <field2>: <type2>, ... } )
   ```

2. 排序

   索引以升序（`1`）或降序（`-1`）排序顺序存储对字段的引用。对于单字段索引，键的排序顺序无关紧要，因为MongoDB可以在任一方向上遍历索引。但是，对于复合索引，排序顺序对于确定索引是否可以支持排序操作很重要。 

