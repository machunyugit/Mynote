## 积硅步， 致千里

### 固定集合

固定集合需要事先创建好, 而且它的大小是固定的. __向一个已经满了的固定结合中插入数据会咋样? 答案是, 固定集合的行为类似于循环队列. 如果已经没有了空间了, 最老的文档会被删除以释放空间. 新插入的文档会占据这块空间.__

### 创建固定集合

```html
//创建一个名为 log 的集合, 允许存储最大文档数为 100 , 最大的空间为5M的文档集合
db.createCollection("log",{capped:true,size:5242880,max:100})
```

### 自然排序

1. 对于固定集合可以进行一种特殊的排序, 成为自然排序。自然排序返回结果集中文档的顺序就是文档在磁盘上的顺序。 使用 `{"$natural":1}` 进行排序。

2. 对于大多数集合来说， 自然排序的意义不大， 因为文档的位置经常变动。但是，固定集合中的文档 是按照文档被插入的顺序保存的。自然顺序就是文档的 插入顺序。

   ```html
   //按照自然顺序的正序排序
   db.log.find().sort({"$natural":1});
   //按照自然顺序的倒序排序
   db.log.find().sort({"$natural":-1});
   ```

### TTl索引

1. 对于固定集合中的内容合适被覆盖, 只拥有非常有限的控制权限,如果需要更加类或的老化移出系统( age-out system )。可以使用TTL索引（time-to-live index）。这种索引允许为每一个文档设置一个超时时间。一个文档到达预设置的老化程度之后就会被删除。这种类型的索引对于缓存问题非常有用。

2. 数据到期

   * TTL索引在索引字段值超过指定的秒数后过期文档; 即，到期阈值是索引字段值加上指定的秒数。
   * 如果字段是数组，并且索引中有多个日期值，则MongoDB使用数组中的*最低*（即最早）日期值来计算到期阈值。
   * 如果文档中的索引字段不是日期 或包含日期值的数组，则文档将不会过期。
   * 如果文档不包含索引字段，则文档不会过期

3. 创建

   ```javascript
   //创建一个10秒以后自动删除
   db.log.createIndex({"cTiem":1},{expireAfterSeconds:10});
   //写入数据
   db.log.insert({"_id":1,"cTime":new Date()});
   ```

### 地理空间索引

1. 创建空间位置索引 `https://blog.csdn.net/zhangzhebjut/article/details/23021073` 





