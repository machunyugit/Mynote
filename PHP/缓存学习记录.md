# 缓存

## 适合放到缓存

1. 缓存实时性变化不严格的内容
2. 缓存经常访问但改动不频繁的内容

## CDN缓存服务

CDN：内容分发网络（Content delivery network或Content distribution network）是指一种通过互联网互相连接的电脑网络系统，利用最靠近每位用户的服务器，更快、更可靠地将音乐、图片、视频、应用程序及其他文件发送给用户，来提供高性能、可扩展性及低成本的网络内容传递给用户。 

## 数据文件缓存

1. 将更新频率极低且读取机率高的数据缓存为文件，（json文件）
2. 获取时不再查询数据库而是直接读和解析文件内容。

## 全页面静态化

1. 有利于搜索引擎优化SEO，加快收录速度
2. 减轻服务器负担，减少数据库请求和运算量
3. 加快页面打开速度，便于进行CDN加速
4. 防止漏洞和入侵
5. 非常适合于文章类网站

## Bigpipe缓存技术

| 方法                | 作用                                             | 解释                                                         |
| ------------------- | ------------------------------------------------ | ------------------------------------------------------------ |
| ob_start()          | 打开输出缓存区                                   |                                                              |
| flush（）           | 将当前为止Tcp buffer中内容发送到用户的浏览器。   | flush()函数不会对服务或者客户端浏览器的缓存模式产生影响，因此，必须同时使用ob_flush()和flush()函数来刷新输出缓存。 |
| ob_flush()          | 将php buffer中的内容送出到Tcp buffer中           | 调用ob_flush() 之后缓存区内容将被丢弃。                      |
| ob_get_contents()   | 返回内部缓存区的内容                             | 只是得倒输出缓冲区的内容，但不清除它。没有激活，则返回false  |
| ob_get_length()     | 返回内部缓冲区的长度                             |                                                              |
| ob_end_clean()      | 删除内部缓冲区的内容，并且关闭内部缓存区。       |                                                              |
| ob_end_flush()      | 发送内部缓存区的内容到浏览器，并且关闭输出缓冲区 |                                                              |
| ob_implicit_flush() | 默认为关闭缓存区                                 | 打开绝对输出后，每个脚本输出都直接发送到浏览器，不需要调用flush()。 |

## 浏览器缓存

### 类型

1. 强缓存
2. 协商缓存

### 输出方式

1. html的方式

   ```html
   <meta http-equiv="Cache-Control" content="max-age=7200">
   ```

2. php输出

   ```php
   header('Cache-control:max-age=7200');
   ```

### 强缓存

Cache-control ( http1.1 )

* max-age 设置缓存时间

* Public / private  

  当请求的是https协议的时候，会转换为private参数

* no-cache / no-store / mush-revalidete

  ```html
  no-cache 不允许缓存
  no-store 不允许存储到客户端的磁盘中
  must-revalidate 必须满足某些条件
  ```

### 协商缓存阶段（304）

* Last-modifie : 末次更新标记（下行）

* if-Modified-Since : 资源上次的修改时间（上行）

  

* E-Tag ： 实体与标记（下行）

* if-None-Match ： 资源内容标识（上行）

__上行：__ 表示浏览器向服务器发起的请求

__下行：__ 表示服务器向浏览器发出的响应

## PHP的APC和Opcache

1. Opcache 是一种通过解析的PHP脚本预编译的字节码存放在共享内存中来避免每次加载和解析PHP脚本的开销。
2. 解析器可以直接从共享内存读取已经缓存的字节码，从而大大提高PHP的执行效率。
3. APC是缓存、优化PHP中间代码的架构，可以缓存Opcodes。
4. PHP5.5以后，Zend Opcache 整合到PHP中，并可以代替APC使用，此功能默认关闭