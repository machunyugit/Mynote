# 手册

## Git 快速入门

### 入门概念

1. 对于任何一个文件, Git内部的三种状态: 已提交( committed ), 已修改( modified ) 和 已暂存( staged);

   - __已提交__ , 表示该文件已经被安全地保存在本地数据库中
   - __已修改__ 表示修改了某个文件, 但是还没有提交保存
   - __已暂存__ 表示把已经修改的文件放在下次提交时要保存的清单中

2. 文件流转的三个工作区域: git的工作目录, 暂存区域, 以及本地仓库

   ![bg2014061202](./img/bg2014061202.jpg)

### 初始化项目

`git init`  通过`git init`命令把当前目录变成Git可以管理的仓库

```shell
cd project_dir 
git init
#or
git init project_dir #创建新目录
```

### 从现有仓库克隆

```shell
git clone https://github.com/laravel/laravel.git  #克隆不创建新目录 使用原来的目录
git clone https://github.com/laravel/laravel.git laravelTest #克隆并创建新目录
```

## 基础

### 配置

1. 配置 `user.name` 和 `user.email`

   ```shell
   # 项目配置，只对某个仓库有效	
   	git config --local user.name 'your_name'
   	git config --local user.email 'your_email@domain.com'
   # 全局配置，对当前所有仓库有效
       git config --global user.name 'your_name'
       git config --global user.email 'your_email@domain.com'
   # 系统配置，对系统所有登录的用户有效
   	git config --system user.name 'your_name'
   	git config --system user.email 'your_email@domain.com'
   ```

### 基础命令

1. 查看当前状态

   ```shell
   git status
   ```

2. 跟踪新文件

   ```shell
   git add file
   git add ./*
   ```

3. 查看已暂存和未暂存的修改

   ```shell
   git diff file 		#未暂存的修改
   git diff --cached 	#已经暂存的修改
   ```

4. 提交更新

   ```shell
   git commit -m 'describe'
   git commit -am 'describe' #跳过使用暂存区域
   ```

5. 移除文件

   * `git rm filename` 从已跟踪文件清单中移除，并把工作目录中的文件也删除。
   * 如果删除之前修改过并且已经放到暂存区域的话，则必须要用强制删除选项 `-f`（译注：即 force 的首字母）。 这是一种安全特性，用于防止误删还没有添加到快照的数据，这样的数据不能被 Git 恢复。
   * `git rm --cached` 从暂存区域移除。

6. 重命名或者移动文件

   ```shell
   git mv file_from file_to
   
   #上述命令相当于
   mv file_from file_to
   git rm file_from
   git add file_to
   ```

7. git命令行没有颜色 `git config --global color.ui true`

### 查看历史

1. `git log` 					会按提交时间列出所有的更新。
2. `git log -p -2`                           显示最近两次提交。
3. `git log --grep kewWord`         查询指定关键字的提交。
4. `git log -g`                                  输出格式的引用日志信息。
5. `git log --all --graph`            图型化查看分支的演变历史。

### 撤销操作 

1. 提交完了才发现漏掉了几个文件没有添加，或者提交信息写错了。

   ```shell
   git commit -amend
   ```

2. 取消暂存文件。

   ```shell
   git reset HEAD file_name
   ```

3. 撤销对文件的修改。

   ```shell
   git checkout -- file_name
   ```

4. 撤销未提交的 `commit`。

   ```shell
   git reset HEAD^  #撤销最近一次的commit
   ```

## 对比差异

1. 查看未加入暂存区和暂存区的差异

   ```shell
   git diff 1.css
   ```

2. 查看加暂存区和提交的差异

   ```shell
   git diff --cached 1.css
   ```

3. 不同提交的指定文件的差异

   ```shell
   #查看最近2条提交历史
   git log -n2
   git diff commit-id1 commit-id2 path-to-file
   ```

### 别名

```shell
git config --global alias.st status
```

### [分支的基变](<https://git-scm.com/book/zh/v2/Git-%E5%88%86%E6%94%AF-%E5%8F%98%E5%9F%BA>)

## 版本回退

1. 使用 `git log` 查看实际工作中历史记录

   ![20180627001305](./img/20180627001305.png)

2. Git必须知道当前版本是哪个版本，在Git中，用`HEAD`表示当前版本，也就是最新的提交34aca0...`（注意我的提交ID和你的肯定不一样），上一个版本就是`HEAD^`，上上一个版本就是`HEAD^^`，当然往上100个版本写100个`^`比较容易数不过来，所以写成`HEAD~100`。 

   ```html
   #回退上一个版本
   git reset --hard HEAD^
   git reset --hard HEAD～1
   #回退到指定版本
   git reset --hard 34aca0a6e4670b882
   ```

3. Git提供了一个命令`git reflog`用来记录你的每一次命令： 

   ![20180627001945](./img/20180627001945.png)

4. 撤销修改

   - 命令`git checkout -- readme.txt`意思就是，把`readme.txt`文件在工作区的修改全部撤销，这里有两种情况：
   - 一种是`readme.txt`自修改后还没有被放到暂存区，现在，撤销修改就回到和版本库一模一样的状态；
   - 一种是`readme.txt`已经添加到暂存区后，又作了修改，现在，撤销修改就回到添加到暂存区后的状态。
   - 总之，就是让这个文件回到最近一次`git commit`或`git add`时的状态。
   - `git checkout -- file`命令中的`-- `很重要，没有`--`，就变成了“切换到另一个分支”的命令，我们在后面的分支管理中会再次遇到`git checkout`命令。 


## git 工具

### 储藏（Stashing）

“‘储藏”“可以获取你工作目录的中间状态——**修改过的被追踪的文件**和**暂存的变更**——并将它保存到一个未完结变更的堆栈中，随时可以重新应用。

1. 存储

   ```shell
   git stash
   ```

2. 查看现有的存储。

   ```shell
   git stash list
   #stash@{0}: WIP on master: 330e68b test
   ```

3. 重新应用存储。**apply 选项只尝试应用储藏的工作——储藏的内容仍然在栈上。**

   ```shell
   git stash apply					#默认最新的一条
   git stash apply stash@{0}		#任意存储
   git stash pop 					#来重新应用储藏，并将储藏删掉
   ```

4. 删除存储。

   ```shell
   git stash drop
   ```

## [配置 git](<https://git-scm.com/book/zh/v1/%E8%87%AA%E5%AE%9A%E4%B9%89-Git-%E9%85%8D%E7%BD%AE-Git>)

## [数据恢复](<https://git-scm.com/book/zh/v1/Git-%E5%86%85%E9%83%A8%E5%8E%9F%E7%90%86-%E7%BB%B4%E6%8A%A4%E5%8F%8A%E6%95%B0%E6%8D%AE%E6%81%A2%E5%A4%8D>)

## 其他命令

1. 查看 git 使用的空间

   ```shell
   git count-objects -v
   ```

